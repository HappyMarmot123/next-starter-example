# Next.js 14 가이드

## Next.js 장점

1. 🔥 서버 사이드 렌더링 (SSR)
2. 🔥 쉽고 빠른 경로기반 라우팅
3. 리액트 훅에 많이 의존하지 않음
4. Vercel과의 통합으로 쉬운 배포

## 서버 렌더링과 하이드레이션

서버는 비상호작용(non-interactive) HTML 파일을 응답합니다.  
클라이언트에서는 이 HTML을 JavaScript를 통해 상호작용(interactive)할 수 있도록 만듭니다. 이를 **hydrate**라고 합니다.  
hydrate는 CSR방식에서 작동합니다. 즉 CSR방식은 서버에서 동적인 HTML을 응답한 후 React Init 따위의 함수를 실행하는 것입니다.  
SSR방식에서 왜 일부 훅을 사용할 수 없는지 알 수 있습니다.  
이 방식은 공개된 HTML 코드로 인해 구글 엔진이 활성화 되도록 합니다.

클라이언트 컴포넌트 안에서 서버 컴포넌트를 포함할 수 없으며, 그 반대는 가능합니다.  
서버 컴포넌트는 데이터베이스와 통신할 수 있습니다.  
또한 민감한 데이터를 클라이언트로부터 숨길 수 있는 장점이 있습니다.

## use client 선언 시

### 클라이언트 컴포넌트

- 클라이언트에서 렌더링되며, 사용자와 상호작용하는 기능을 포함할 수 있습니다.

**사용할 수 없는 기능**

- 서버 전용 기능: 데이터베이스 접근, 서버 사이드 로직, API 경로 처리 등은 직접 사용할 수 없음.
- 비동기 데이터 패칭: getStaticProps, getServerSideProps 같은 Next.js의 데이터 패칭 함수 사용 불가.

## use client 비선언 시

### 서버 컴포넌트

- 서버에서 렌더링되며, 주로 데이터베이스와 통신하는 데 사용됩니다.

**사용할 수 있는 기능**

- 서버 사이드 데이터 패칭: getStaticProps, getServerSideProps를 통해 서버에서 데이터를 가져올 수 있음.
- 서버와의 통신: 데이터베이스에 직접 접근하거나 API를 호출할 수 있음.
- HTML 렌더링: 클라이언트 없이 HTML을 렌더링하여 SEO와 성능 최적화에 유리.

**사용할 수 없는 기능**

- 상태 관리 훅: useState, useEffect와 같은 클라이언트 훅을 사용할 수 없음.
- 이벤트 핸들링: 사용자 상호작용 이벤트를 처리할 수 없음.
- 클라이언트 전용 라이브러리: 브라우저에서만 작동하는 라이브러리(예: DOM 관련 라이브러리)를 사용할 수 없음.

### 서버사이드 컴포넌트

기본적인 서버 측 데이터를 가져오기 위해서는 컴포넌트를 비동기로 만들어야 합니다.
async function Page() {"use server" ...}

## 레이아웃

Next.js는 레이아웃 컴포넌트를 먼저 렌더링하고, 그 안에 포함된 페이지 컴포넌트를 렌더링합니다.  
Java의 include와 유사하게, 전역으로 고정할 컴포넌트(헤더, 푸터 등)를 선언할 수 있습니다.  
페이지 구성 요소만 업데이트되고 레이아웃은 다시 렌더링되지 않는다는 부분 렌더링 이점이 있습니다.  
레이아웃은 여러 개 선언할 수 있으며, 경로에 따라 부모 순서가 변경됩니다.

<Layout>  
 <YourPages />  
</Layout>

## Link prefetch

프로덕션에서 브라우저 뷰포트에 <Link> 구성 요소가 나타날 때마다 Next.js는  
자동으로 백그라운드에서 링크된 경로의 코드를 미리 가져옵니다. 이는 굉장한 사용자 경험을 향상시킵니다.  
사용자가 링크를 클릭할 때쯤이면 대상 페이지의 코드가 이미 백그라운드에서 로드되어 있습니다.  
이와 반대로 <a> 요소는 클릭시 페이지가 새로고침 됩니다.

## Cache

Next에는 Router Cache 라는 메모리 내 클라이언트가 있습니다.  
사용자가 앱을 탐색할 때 미리 가져온 경로 페이지와 방문한 경로의 React Server Component Payload가 캐시에 저장됩니다.
페이지 탐색 시 서버에 새로운 요청을 하는 대신 캐시를 최대한 재사용하여 요청 수와 전송되는 데이터 수를 줄여 성능을 향상시킵니다.  
이 뿐만 아니라 fetch data에도 캐시가 되는 것이 디폴트이기 때문에 불필요한 데이터 조회가 없는 것을 네트워크에서 확인할 수 있습니다.

## 메타데이터

클라이언트 컴포넌트에서는 메타데이터를 사용할 수 없습니다.
메타데이터는 비동기 함수로 사용할 수 있습니다.  
트리구조로 다른 메타데이터 코드와 병합(merge) 됩니다.
